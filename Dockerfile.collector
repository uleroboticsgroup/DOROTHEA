FROM alpine:3.19

# Metadata labels
LABEL version="1.0.0" 
LABEL license="LGPL-3.0"
LABEL maintainer="guillermo.leiro@estudiantes.uva.es"
LABEL description="Docker container to collect netflows"

### Collector ###

# Install netflowd as netflow collector
RUN apk update && apk add nfdump

# Port for incoming netflows
ENV PORT=9555

# Directory to dump the netflows
ENV NF_CAPS_STORE_DIR=/nfcaps/caps

EXPOSE 9555

# Running nfcapd, $(extracting IP of interface recieving the netflows)
CMD nfcapd -b $(ip -4 addr show dev eth0 | grep inet | awk '{print $2}' | cut -d'/' -f1) -p ${PORT} -w ${NF_CAPS_STORE_DIR} -t 60